(function(global) {
  const F = (frame, from, delta) => (frame - FRAME_FOR_BEAN(from)) / (FRAME_FOR_BEAN(from + delta) - FRAME_FOR_BEAN(from));
  class bird extends NIN.THREENode {
    constructor(id) {
      super(id, {
        outputs: {
          render: new NIN.TextureOutput()
        }
      });

      this.canvas = document.createElement('canvas');
      this.ctx = this.canvas.getContext('2d');
      this.resize();
      this.output = new THREE.VideoTexture(this.canvas);
      this.output.minFilter = THREE.LinearFilter;
      this.output.magFilter = THREE.LinearFilter;

      this.data = {"Contents": {"Rectangle 7": {"Contents": {"Size": [59,103]}, "Transform": {"Position": {"32.7833333333333": [-391.302937620317,-302.643442196631], "33.2666666666667": [-437.5,-260], "33.3166666666667": [-438,-260.5], "33.7333333333333": [-437.5,-260], "33.7833333333333": [-438,-260.5], "34.2": [-437.5,-260], "34.25": [-438,-260.5], "34.6666666666667": [-437.5,-260], "34.7166666666667": [-438,-260.5], "35.1333333333333": [-437.5,-260], "35.1833333333333": [-438,-260.5]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [21.1828283583726,29.7366975882204], "33.7333333333333": [21.1828283583726,29.7366975882204], "34.2": [21.1828283583726,29.7366975882204], "34.6666666666667": [21.1828283583726,29.7366975882204], "35.1333333333333": [21.1828283583726,29.7366975882204]}, "Rotation": {"33.2666666666667": [-92.1565536169005], "33.6833333333333": [-103.046033397691], "33.7333333333333": [-92.1565536169005], "34.15": [-103.046033397691], "34.2": [-92.1565536169005], "34.6166666666667": [-103.046033397691], "34.6666666666667": [-92.1565536169005], "35.0833333333333": [-103.046033397691], "35.1333333333333": [-92.1565536169005], "35.55": [-103.046033397691]}}}, "Rectangle 5": {"Contents": {"Size": [59,103]}, "Transform": {"Position": {"32.7833333333333": [-509.447744942419,-344.465163294946], "33.2666666666667": [-413.5,-280.5], "33.3166666666667": [-414,-280.5], "33.7333333333333": [-413.5,-280.5], "33.7833333333333": [-414,-280.5], "34.2": [-413.5,-280.5], "34.25": [-414,-280.5], "34.6666666666667": [-413.5,-280.5], "34.7166666666667": [-414,-280.5], "35.1333333333333": [-413.5,-280.5], "35.1833333333333": [-414,-280.5]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [21.1828283583726,49.5611626470341], "33.7333333333333": [21.1828283583726,49.5611626470341], "34.2": [21.1828283583726,49.5611626470341], "34.6666666666667": [21.1828283583726,49.5611626470341], "35.1333333333333": [21.1828283583726,49.5611626470341]}, "Rotation": {"33.2666666666667": [-116.451494384576], "33.6166666666667": [-109.736479529036], "33.7333333333333": [-116.451494384576], "34.0833333333333": [-109.736479529036], "34.2": [-116.451494384576], "34.55": [-109.736479529036], "34.6666666666667": [-116.451494384576], "35.0166666666667": [-109.736479529036], "35.1333333333333": [-116.451494384576], "35.4833333333333": [-109.736479529036]}}}, "Rectangle 8": {"Contents": {"Size": [59,103]}, "Transform": {"Position": {"32.7833333333333": [-106.898738559215,-313.607240366105], "33.2666666666667": [-329,-306.5], "33.3166666666667": [-320.5,-294.5], "33.3666666666667": [-323.5,-217], "33.4333333333333": [-320.5,-194], "33.5": [-342.5,-190], "33.5666666666667": [-325.5,-195], "33.6166666666667": [-321.5,-213], "33.6833333333333": [-300.5,-274], "33.7333333333333": [-329,-306.5], "33.7833333333333": [-320.5,-294.5], "33.8333333333333": [-323.5,-217], "33.9": [-320.5,-194], "33.9666666666667": [-342.5,-190], "34.0333333333333": [-325.5,-195], "34.0833333333333": [-321.5,-213], "34.15": [-300.5,-274], "34.2": [-329,-306.5], "34.25": [-320.5,-294.5], "34.3": [-323.5,-217], "34.3666666666667": [-320.5,-194], "34.4333333333333": [-342.5,-190], "34.5": [-325.5,-195], "34.55": [-321.5,-213], "34.6166666666667": [-300.5,-274], "34.6666666666667": [-329,-306.5], "34.7166666666667": [-320.5,-294.5], "34.7666666666667": [-323.5,-217], "34.8333333333333": [-320.5,-194], "34.9": [-342.5,-190], "34.9666666666667": [-325.5,-195], "35.0166666666667": [-321.5,-213], "35.1333333333333": [-329,-306.5], "35.1833333333333": [-320.5,-294.5], "35.2333333333333": [-323.5,-217], "35.3": [-320.5,-194], "35.3666666666667": [-342.5,-190], "35.4333333333333": [-325.5,-195], "35.4833333333333": [-321.5,-213], "35.55": [-300.5,-274]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [100,119.774456926593], "33.3666666666667": [90.1057923847739,137.840294245927], "33.5": [90.1057923847739,124.885160635767], "33.6166666666667": [90.1057923847739,136.79575662435], "33.7333333333333": [100,119.774456926593], "33.8333333333333": [90.1057923847739,137.840294245927], "33.9666666666667": [90.1057923847739,124.885160635767], "34.0833333333333": [90.1057923847739,136.79575662435], "34.2": [100,119.774456926593], "34.3": [90.1057923847739,137.840294245927], "34.4333333333333": [90.1057923847739,124.885160635767], "34.55": [90.1057923847739,136.79575662435], "34.6666666666667": [100,119.774456926593], "34.7666666666667": [90.1057923847739,137.840294245927], "34.9": [90.1057923847739,124.885160635767], "35.0166666666667": [90.1057923847739,136.79575662435], "35.1333333333333": [100,119.774456926593], "35.2333333333333": [90.1057923847739,137.840294245927], "35.3666666666667": [90.1057923847739,124.885160635767], "35.4833333333333": [90.1057923847739,136.79575662435]}, "Rotation": {"32.7833333333333": [-65.0997589722536], "33.2666666666667": [25.2307044581069], "33.3166666666667": [44.990328780602], "33.3666666666667": [131.404093915149], "33.4333333333333": [138.969603342892], "33.5": [176.214793226617], "33.5666666666667": [144.887267839553], "33.6166666666667": [127.259403327078], "33.6833333333333": [71.5657983346059], "33.7333333333333": [25.2307044581069], "33.7833333333333": [44.990328780602], "33.8333333333333": [131.404093915149], "33.9": [138.969603342892], "33.9666666666667": [176.214793226617], "34.0333333333333": [144.887267839553], "34.0833333333333": [127.259403327078], "34.15": [71.5657983346059], "34.2": [25.2307044581069], "34.25": [44.990328780602], "34.3": [131.404093915149], "34.3666666666667": [138.969603342892], "34.4333333333333": [176.214793226617], "34.5": [144.887267839553], "34.55": [127.259403327078], "34.6166666666667": [71.5657983346059], "34.6666666666667": [25.2307044581069], "34.7166666666667": [44.990328780602], "34.7666666666667": [131.404093915149], "34.8333333333333": [138.969603342892], "34.9": [176.214793226617], "34.9666666666667": [144.887267839553], "35.0166666666667": [127.259403327078], "35.1333333333333": [25.2307044581069], "35.1833333333333": [44.990328780602], "35.2333333333333": [131.404093915149], "35.3": [138.969603342892], "35.3666666666667": [176.214793226617], "35.4333333333333": [144.887267839553], "35.4833333333333": [127.259403327078], "35.55": [71.5657983346059]}}}, "Rectangle 6": {"Contents": {"Size": [123.5,57.5]}, "Transform": {"Position": {"32.7833333333333": [-375.75,-99.1051926778978], "33.2666666666667": [-375.75,-241.25], "33.3166666666667": [-378.25,-241.75], "33.3666666666667": [-377.75,-244.25], "33.4333333333333": [-376.75,-246.25], "33.5": [-371.75,-242.25], "33.5666666666667": [-383.75,-238.25], "33.6833333333333": [-372.75,-239.25], "33.7333333333333": [-375.75,-241.25], "33.7833333333333": [-378.25,-241.75], "33.8333333333333": [-377.75,-244.25], "33.9": [-376.75,-246.25], "33.9666666666667": [-371.75,-242.25], "34.0333333333333": [-383.75,-238.25], "34.15": [-372.75,-239.25], "34.2": [-375.75,-241.25], "34.25": [-378.25,-241.75], "34.3": [-377.75,-244.25], "34.3666666666667": [-376.75,-246.25], "34.4333333333333": [-371.75,-242.25], "34.5": [-383.75,-238.25], "34.6166666666667": [-372.75,-239.25], "34.6666666666667": [-375.75,-241.25], "34.7166666666667": [-378.25,-241.75], "34.7666666666667": [-377.75,-244.25], "34.8333333333333": [-376.75,-246.25], "34.9": [-371.75,-242.25], "34.9666666666667": [-383.75,-238.25], "35.1333333333333": [-375.75,-241.25], "35.1833333333333": [-378.25,-241.75], "35.2333333333333": [-377.75,-244.25], "35.3": [-376.75,-246.25], "35.3666666666667": [-371.75,-242.25], "35.4333333333333": [-383.75,-238.25], "35.55": [-372.75,-239.25]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [81.4259103108302,58.823575650315], "33.7333333333333": [81.4259103108302,58.823575650315], "34.2": [81.4259103108302,58.823575650315], "34.6666666666667": [81.4259103108302,58.823575650315], "35.1333333333333": [81.4259103108302,58.823575650315]}, "Rotation": {"32.7833333333333": [23.5928925632061], "33.2666666666667": [38.0163096448081], "33.5": [23.8958631855764], "33.5666666666667": [34.4888920303247], "33.7333333333333": [38.0163096448081], "33.9666666666667": [23.8958631855764], "34.0333333333333": [34.4888920303247], "34.2": [38.0163096448081], "34.4333333333333": [23.8958631855764], "34.5": [34.4888920303247], "34.6666666666667": [38.0163096448081], "34.9": [23.8958631855764], "34.9666666666667": [34.4888920303247], "35.1333333333333": [38.0163096448081], "35.3666666666667": [23.8958631855764], "35.4333333333333": [34.4888920303247]}}}, "Rectangle 3": {"Contents": {"Size": [123.5,57.5]}, "Transform": {"Position": {"32.7833333333333": [-171.738560572793,-121.203723867739], "33.2666666666667": [-354.75,-240.25], "33.3166666666667": [-353.25,-237.75], "33.3666666666667": [-350.25,-232.25], "33.4333333333333": [-349.25,-240.25], "33.5": [-346.25,-250.25], "33.5666666666667": [-351.25,-246.25], "33.6166666666667": [-350.25,-250.25], "33.6833333333333": [-365.25,-250.25], "33.7333333333333": [-354.75,-240.25], "33.7833333333333": [-353.25,-237.75], "33.8333333333333": [-350.25,-232.25], "33.9": [-349.25,-240.25], "33.9666666666667": [-346.25,-250.25], "34.0333333333333": [-351.25,-246.25], "34.0833333333333": [-350.25,-250.25], "34.15": [-365.25,-250.25], "34.2": [-354.75,-240.25], "34.25": [-353.25,-237.75], "34.3": [-350.25,-232.25], "34.3666666666667": [-349.25,-240.25], "34.4333333333333": [-346.25,-250.25], "34.5": [-351.25,-246.25], "34.55": [-350.25,-250.25], "34.6166666666667": [-365.25,-250.25], "34.6666666666667": [-354.75,-240.25], "34.7166666666667": [-353.25,-237.75], "34.7666666666667": [-350.25,-232.25], "34.8333333333333": [-349.25,-240.25], "34.9": [-346.25,-250.25], "34.9666666666667": [-351.25,-246.25], "35.0166666666667": [-350.25,-250.25], "35.1333333333333": [-354.75,-240.25], "35.1833333333333": [-353.25,-237.75], "35.2333333333333": [-350.25,-232.25], "35.3": [-349.25,-240.25], "35.3666666666667": [-346.25,-250.25], "35.4333333333333": [-351.25,-246.25], "35.4833333333333": [-350.25,-250.25], "35.55": [-365.25,-250.25]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [100,44.3675063035663], "33.6833333333333": [100,52.3645054840271], "33.7333333333333": [100,44.3675063035663], "34.15": [100,52.3645054840271], "34.2": [100,44.3675063035663], "34.6166666666667": [100,52.3645054840271], "34.6666666666667": [100,44.3675063035663], "35.0833333333333": [100,52.3645054840271], "35.1333333333333": [100,44.3675063035663], "35.55": [100,52.3645054840271]}, "Rotation": {"33.2666666666667": [8.75082444463413], "33.5": [16.8373614321901], "33.7333333333333": [8.75082444463413], "33.9666666666667": [16.8373614321901], "34.2": [8.75082444463413], "34.4333333333333": [16.8373614321901], "34.6666666666667": [8.75082444463413], "34.9": [16.8373614321901], "35.1333333333333": [8.75082444463413], "35.3666666666667": [16.8373614321901]}}}, "Rectangle 2": {"Contents": {"Size": [100,33]}, "Transform": {"Position": {"32.7833333333333": [-266.669569725421,-321.501365125472], "33.2666666666667": [-272,-222], "33.3166666666667": [-271.5,-220], "33.5": [-279.5,-225], "33.6833333333333": [-273.5,-217], "33.7333333333333": [-272,-222], "33.7833333333333": [-271.5,-220], "33.9666666666667": [-279.5,-225], "34.15": [-273.5,-217], "34.2": [-272,-222], "34.25": [-271.5,-220], "34.4333333333333": [-279.5,-225], "34.6166666666667": [-273.5,-217], "34.6666666666667": [-272,-222], "34.7166666666667": [-271.5,-220], "34.9": [-279.5,-225], "35.0833333333333": [-273.5,-217], "35.1333333333333": [-272,-222], "35.1833333333333": [-271.5,-220], "35.3666666666667": [-279.5,-225], "35.55": [-273.5,-217]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [100,46.4538572996121], "33.7333333333333": [100,46.4538572996121], "34.2": [100,46.4538572996121], "34.6666666666667": [100,46.4538572996121], "35.1333333333333": [100,46.4538572996121]}, "Rotation": {"32.7833333333333": [-101.100217007961], "33.2666666666667": [29.2818213552122], "33.3666666666667": [20.577638241208], "33.5": [26.0622300703099], "33.7333333333333": [29.2818213552122], "33.8333333333333": [20.577638241208], "33.9666666666667": [26.0622300703099], "34.2": [29.2818213552122], "34.3": [20.577638241208], "34.4333333333333": [26.0622300703099], "34.6666666666667": [29.2818213552122], "34.7666666666667": [20.577638241208], "34.9": [26.0622300703099], "35.1333333333333": [29.2818213552122], "35.2333333333333": [20.577638241208], "35.3666666666667": [26.0622300703099]}}}, "Rectangle 1": {"Contents": {"Size": [100,33]}, "Transform": {"Position": {"32.7833333333333": [-650.906929312045,-373.412908237365], "33.2666666666667": [-276,-213.5], "33.3166666666667": [-279.5,-215.5], "33.3666666666667": [-275.5,-218], "33.5": [-284.5,-219], "33.7333333333333": [-276,-213.5], "33.7833333333333": [-279.5,-215.5], "33.8333333333333": [-275.5,-218], "33.9666666666667": [-284.5,-219], "34.2": [-276,-213.5], "34.25": [-279.5,-215.5], "34.3": [-275.5,-218], "34.4333333333333": [-284.5,-219], "34.6666666666667": [-276,-213.5], "34.7166666666667": [-279.5,-215.5], "34.7666666666667": [-275.5,-218], "34.9": [-284.5,-219], "35.1333333333333": [-276,-213.5], "35.1833333333333": [-279.5,-215.5], "35.2333333333333": [-275.5,-218], "35.3666666666667": [-284.5,-219]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [100,46.4538572996121], "33.6833333333333": [105.21311933423,53.4746670623771], "33.7333333333333": [100,46.4538572996121], "34.15": [105.21311933423,53.4746670623771], "34.2": [100,46.4538572996121], "34.6166666666667": [105.21311933423,53.4746670623771], "34.6666666666667": [100,46.4538572996121], "35.0833333333333": [105.21311933423,53.4746670623771], "35.1333333333333": [100,46.4538572996121], "35.55": [105.21311933423,53.4746670623771]}, "Rotation": {"32.7833333333333": [41.6745561889697], "33.2666666666667": [29.2818213552122], "33.5666666666667": [32.0623894002039], "33.6833333333333": [27.4698726362181], "33.7333333333333": [29.2818213552122], "34.0333333333333": [32.0623894002039], "34.15": [27.4698726362181], "34.2": [29.2818213552122], "34.5": [32.0623894002039], "34.6166666666667": [27.4698726362181], "34.6666666666667": [29.2818213552122], "34.9666666666667": [32.0623894002039], "35.0833333333333": [27.4698726362181], "35.1333333333333": [29.2818213552122], "35.4333333333333": [32.0623894002039], "35.55": [27.4698726362181]}}}, "Rectangle 4": {"Contents": {"Size": [59,103]}, "Transform": {"Position": {"32.7833333333333": [-595.789614644204,-249.722507345738], "33.2666666666667": [-311.5,-301.25], "33.3166666666667": [-298.5,-293.25], "33.3666666666667": [-319,-239.25], "33.4333333333333": [-348,-188.25], "33.5": [-391,-197.25], "33.5666666666667": [-360,-198.25], "33.6166666666667": [-351,-214.25], "33.6833333333333": [-320,-286.25], "33.7333333333333": [-311.5,-301.25], "33.7833333333333": [-298.5,-293.25], "33.8333333333333": [-319,-239.25], "33.9": [-348,-188.25], "33.9666666666667": [-391,-197.25], "34.0333333333333": [-360,-198.25], "34.0833333333333": [-351,-214.25], "34.15": [-320,-286.25], "34.2": [-311.5,-301.25], "34.25": [-298.5,-293.25], "34.3": [-319,-239.25], "34.3666666666667": [-348,-188.25], "34.4333333333333": [-391,-197.25], "34.5": [-360,-198.25], "34.55": [-351,-214.25], "34.6166666666667": [-320,-286.25], "34.6666666666667": [-311.5,-301.25], "34.7166666666667": [-298.5,-293.25], "34.7666666666667": [-319,-239.25], "34.8333333333333": [-348,-188.25], "34.9": [-391,-197.25], "34.9666666666667": [-360,-198.25], "35.0166666666667": [-351,-214.25], "35.1333333333333": [-311.5,-301.25], "35.1833333333333": [-298.5,-293.25], "35.2333333333333": [-319,-239.25], "35.3": [-348,-188.25], "35.3666666666667": [-391,-197.25], "35.4333333333333": [-360,-198.25], "35.4833333333333": [-351,-214.25], "35.55": [-320,-286.25]}, "Scale": {"32.7833333333333": [0,0], "33.2666666666667": [92.3970901951447,115.874126516178], "33.4333333333333": [95.4160961766639,146.75483404151], "33.5": [95.4160961766639,125.500320316733], "33.7333333333333": [92.3970901951447,115.874126516178], "33.9": [95.4160961766639,146.75483404151], "33.9666666666667": [95.4160961766639,125.500320316733], "34.2": [92.3970901951447,115.874126516178], "34.3666666666667": [95.4160961766639,146.75483404151], "34.4333333333333": [95.4160961766639,125.500320316733], "34.6666666666667": [92.3970901951447,115.874126516178], "34.8333333333333": [95.4160961766639,146.75483404151], "34.9": [95.4160961766639,125.500320316733], "35.1333333333333": [92.3970901951447,115.874126516178], "35.3": [95.4160961766639,146.75483404151], "35.3666666666667": [95.4160961766639,125.500320316733]}, "Rotation": {"32.7833333333333": [93.745951751417], "33.2666666666667": [46.381858010458], "33.3166666666667": [60.1123352801373], "33.3666666666667": [113.098923804487], "33.4333333333333": [145.838506030556], "33.5": [191.016916695922], "33.5666666666667": [155.87368488865], "33.6166666666667": [127.542226183954], "33.6833333333333": [60.8851041192626], "33.7333333333333": [46.381858010458], "33.7833333333333": [60.1123352801373], "33.8333333333333": [113.098923804487], "33.9": [145.838506030556], "33.9666666666667": [191.016916695922], "34.0333333333333": [155.87368488865], "34.0833333333333": [127.542226183954], "34.15": [60.8851041192626], "34.2": [46.381858010458], "34.25": [60.1123352801373], "34.3": [113.098923804487], "34.3666666666667": [145.838506030556], "34.4333333333333": [191.016916695922], "34.5": [155.87368488865], "34.55": [127.542226183954], "34.6166666666667": [60.8851041192626], "34.6666666666667": [46.381858010458], "34.7166666666667": [60.1123352801373], "34.7666666666667": [113.098923804487], "34.8333333333333": [145.838506030556], "34.9": [191.016916695922], "34.9666666666667": [155.87368488865], "35.0166666666667": [127.542226183954], "35.1333333333333": [46.381858010458], "35.1833333333333": [60.1123352801373], "35.2333333333333": [113.098923804487], "35.3": [145.838506030556], "35.3666666666667": [191.016916695922], "35.4333333333333": [155.87368488865], "35.4833333333333": [127.542226183954], "35.55": [60.8851041192626]}}}}, "Transform": {"Position": {"32.7833333333333": [1678.5,1023,0], "33.35": [1734.5,1099,0], "34.3666666666667": [494.5,499,0]}, "X Position": [0], "Y Position": [0], "Scale": {"33.4333333333333": [225.122539492333,225.122539492333,100], "34.0166666666667": [320.122539492333,320.122539492333,100]}, "Rotation": [0]}}


      this.keyframes = {};
      const offset = 5500 + 1980;
      const speedMultiplier = 0.8;

      const getKeyframesForItem = item => {
        const keyframes = {
          Position: [],
          Scale: [],
          Rotation: [],
        };
        for(let operation of ['Scale', 'Position', 'Rotation']) {
          for(let seconds in item.Transform[operation]) {
            const frame = ((seconds * 60) + offset) * speedMultiplier | 0;
            keyframes[operation].push({
              frame,
              value: item.Transform[operation][seconds],
            });
          }
          keyframes[operation] = keyframes[operation].sort((a, b) => a.frame - b.frame);
        }
        return keyframes;
      }; 

      for(let shapeName in this.data.Contents) {
        this.keyframes[shapeName] = getKeyframesForItem(this.data.Contents[shapeName]);
      }
      this.keyframes.root = getKeyframesForItem(this.data);

      const getValueForFrame = (shapeName, key, frame) => {
        let fromKeyframe = undefined;
        let toKeyframe = undefined;
        for(let keyframe of this.keyframes[shapeName][key]) {
          toKeyframe = keyframe;
          if(keyframe.frame >= frame) {
            break;
          }
          fromKeyframe = keyframe;
        }
        if(typeof fromKeyframe === 'undefined') {
          fromKeyframe = toKeyframe;
        }
        const value = [];
        for(let i in fromKeyframe.value) {
          if(fromKeyframe === toKeyframe) {
            value.push(fromKeyframe.value[i]);
          } else {
            const t = (frame - fromKeyframe.frame) / (toKeyframe.frame - fromKeyframe.frame);
            value.push(lerp(fromKeyframe.value[i], toKeyframe.value[i], t));
          }
        }
        return value;
      };

      this.playback = {};
      const frameEnd = 8000;
      for(let frame = 7467; frame < frameEnd; frame++) {
        this.playback[frame] = {};
        for(let shapeName in this.keyframes) {
          this.playback[frame][shapeName] = {
            Position: getValueForFrame(shapeName, 'Position', frame),
            Scale: getValueForFrame(shapeName, 'Scale', frame),
            Rotation: getValueForFrame(shapeName, 'Rotation', frame),
          };
        }
      }
      console.log(this.keyframes);
      console.log(this.playback);
    }

    update(frame) {
      super.update(frame);
      this.frame = frame;

    }

    resize() {
      this.canvas.width = 16 * GU;
      this.canvas.height = 9 * GU;
    }

    render() {
      this.ctx.fillStyle = '#00ffc6';
      this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

      const pink = '#ff00ea';
      const white = '#fff';
      const black = '#000';

      const beak = black;
      const colorA = white;
      const colorB = pink;

      const regularColors = {
        'Rectangle 7': beak,
        'Rectangle 5': colorB,
        'Rectangle 8': colorB,
        'Rectangle 6': colorA,
        'Rectangle 3': colorA,
        'Rectangle 2': colorB,
        'Rectangle 1': colorA,
        'Rectangle 4': colorB,
      };

      const shadowColor = 'rgba(0, 0, 0, 0.5)';
      const shadowColors = {
        'Rectangle 7': shadowColor,
        'Rectangle 5': shadowColor,
        'Rectangle 8': shadowColor,
        'Rectangle 6': shadowColor,
        'Rectangle 3': shadowColor,
        'Rectangle 2': shadowColor,
        'Rectangle 1': shadowColor,
        'Rectangle 4': shadowColor,
      };

      this.ctx.save();
      this.ctx.scale(GU / 1920 * 16, GU / 1920 * 16);

      const X = 10;
      const Y = 16;
      const r = 24;
      this.ctx.fillStyle = '#4a9987';
      this.ctx.save();
      this.ctx.translate(0, (this.frame * 20) % (1080 / Y * 2));

      if(BEAN >= 4836 && BEAN < 4860) {
      this.ctx.fillStyle = ((this.frame / 60 / 60 * 190 * 12 / 2) | 0) % 2 ? 'white' : '#4a9987';
      }
      if(BEAN >= 4860) {
      this.ctx.fillStyle = '#00ffc6';
      }
      if(BEAN >= 4872 - 4) {
      this.ctx.fillStyle = '#f442e8';
        this.ctx.rotate(Math.PI / 2);
        this.ctx.translate(0, -GU * 16 * 3);
        this.ctx.scale(2, 2);
      }
      if(BEAN >= 4872 + 12 - 4) {
      this.ctx.fillStyle = '#1232ff';
        this.ctx.translate(0, -GU * 16 * 3);
        this.ctx.rotate(Math.PI / 4);
        this.ctx.scale(2, 2);
      }
      for(let i = 0; i < X; i++) {
        for(let j = -2; j < Y; j++) {
          const x = (i + 0.5 * (j % 2))  / (X - 1) * 1920;
          const y = j / (Y - 1) * 1080;
          this.ctx.fillRect(x - r / 2, y - r / 2, r, r * 3);
        }
      }
      this.ctx.restore();

      this.ctx.translate(
          easeIn(300, 0, F(this.frame, 4800, 48)),
          easeIn(150, 0, F(this.frame, 4800, 48)));

      for(let i = 0; i < 2; i++) {
        this.ctx.save();
        const colors = [shadowColors, regularColors][i];
        if(i == 0) {
          this.ctx.translate(16, 16);
        }
        if(this.frame in this.playback) {
          const root = this.playback[this.frame].root;
          this.ctx.translate(root.Position[0], root.Position[1]);
          this.ctx.scale(root.Scale[0] / 100, root.Scale[1] / 100);
          this.ctx.rotate(root.Rotation[0] / 180 * Math.PI);
          for(let shapeKey in this.playback[this.frame]) {
            if(shapeKey === 'root') {
              continue;
            }
            const shape = this.playback[this.frame][shapeKey];
            this.ctx.save();
            this.ctx.fillStyle = colors[shapeKey];
            this.ctx.translate(shape.Position[0], shape.Position[1]);
            this.ctx.rotate(shape.Rotation[0] / 180 * Math.PI);
            this.ctx.scale(shape.Scale[0] / 100, shape.Scale[1] / 100);
            const [width, height] = this.data.Contents[shapeKey].Contents.Size;
            this.ctx.fillRect(-width / 2, -height / 2, width, height);
            this.ctx.restore();
          }
        }
        this.ctx.restore();
      }


      this.ctx.restore();
      this.output.needsUpdate = true;
      this.outputs.render.setValue(this.output);
    }
  }

  global.bird = bird;
})(this);
